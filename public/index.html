<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <title>C.H AI TOWN</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body>
    <div class="page">
      <!-- 上方品牌列 -->
      <header class="topbar">
        <div class="brand">
          <div class="brand-logo">C.H</div>
          <div class="brand-text">
            <div class="brand-title">AI TOWN</div>
            <div class="brand-sub">板橋 · 洗衣 / 洗鞋 / 洗包 智能前台</div>
          </div>
        </div>
        <div class="topbar-right">
          <span class="topbar-tag">點建築 / NPC 切換角色</span>
          <span class="topbar-tag">支援：洗鞋估價 · 小鎮導覽</span>
        </div>
      </header>

      <!-- 中間：左邊小鎮 + 右邊對話 -->
      <main class="layout">
        <!-- 左側：C.H 小鎮（Phaser） -->
        <section class="town-panel">
          <div class="town-header">
            <div class="town-header-title">
              <span>🏙️</span>
              <span>C.H 小鎮</span>
            </div>
            <div class="town-hint">
              <div class="town-hint-dot"></div>
              <span>點建築 / NPC 會切換右側角色喔</span>
            </div>
          </div>
          <div id="game-root"></div>
        </section>

        <!-- 右側：AI 對話 -->
        <section class="chat-panel">
          <!-- 角色區塊 -->
          <div class="role-header">
            <div class="role-avatar-wrap">
              <img
                id="role-avatar-img"
                src="/images/role-cs.png"
                alt="C.H 客服頭像"
              />
            </div>
            <div class="role-meta">
              <div id="current-role-name" class="role-name">C.H 客服</div>
              <div id="role-badge" class="role-badge">
                對話 · 介紹服務 · 回覆一般問題
              </div>
            </div>
          </div>

          <!-- 角色 tabs -->
          <div id="role-tabs" class="role-tabs"></div>

          <!-- 對話內容 -->
          <div id="chat-box" class="chat-box"></div>

          <!-- 快捷問題 -->
          <div id="quick-questions" class="quick-questions"></div>

          <!-- 底部輸入區 + 洗鞋估價按鈕 -->
          <div class="chat-input-row">
            <button
              id="shoe-flow-btn"
              type="button"
              class="secondary-btn"
              title="由 AI 協助逐步詢問，給你洗鞋成功率與估價區間"
            >
              🥿 洗鞋估價
            </button>
            <form id="chat-form">
              <input
                id="user-input"
                type="text"
                placeholder="輸入想問的問題，例如：這雙麂皮鞋發霉還救得回來嗎？"
                autocomplete="off"
              />
              <button type="submit">送出</button>
            </form>
          </div>
        </section>
      </main>
    </div>

    <!-- 新手導覽 overlay -->
    <div id="onboarding-overlay" class="onboarding-overlay">
      <div class="onboarding-card">
        <div class="onboarding-header">
          <div class="onboarding-title">歡迎來到 C.H AI 小鎮 👋</div>
          <button id="onboarding-close" class="onboarding-btn-secondary">
            先略過
          </button>
        </div>
        <div class="onboarding-step-list">
          <div class="onboarding-step">
            <div class="onboarding-step-num">1</div>
            <div>
              <strong>左邊小鎮：</strong>點房子或 NPC，
              右側會切換不同角色（客服、店長、師傅、外送員）。
            </div>
          </div>
          <div class="onboarding-step">
            <div class="onboarding-step-num">2</div>
            <div>
              <strong>右側對話：</strong>上面是目前角色，下方有快捷問題，
              也可以直接輸入你的狀況讓 AI 幫你分析。
            </div>
          </div>
          <div class="onboarding-step">
            <div class="onboarding-step-num">3</div>
            <div>
              <strong>洗鞋估價：</strong>點右下角
              <span style="white-space:nowrap;">「🥿 洗鞋估價」</span>
              或點外送員 NPC，會啟動一步步問答，算給你成功率與價格區間。
            </div>
          </div>
        </div>
        <div class="onboarding-actions">
          <button
            id="onboarding-start-btn"
            class="onboarding-btn-primary"
          >
            我懂了，開始逛小鎮
          </button>
        </div>
      </div>
    </div>

    <!-- 先載入 Phaser，讓左邊小鎮可以運作 -->
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.0/dist/phaser.min.js"></script>

    <!-- 右邊聊天室邏輯 -->
    <script src="/app.js"></script>

    <!-- 左邊小鎮互動（點建築切換角色 / NPC 對話） -->
    <script src="/game.js"></script>
  </body>
</html>
